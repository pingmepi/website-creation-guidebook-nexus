module.exports=[56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},36313,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.HooksClientContext},18341,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.ServerInsertedHtml},91119,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(68114);let e=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("div",{ref:e,className:(0,d.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...c}));e.displayName="Card";let f=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("div",{ref:e,className:(0,d.cn)("flex flex-col space-y-1.5 p-6",a),...c}));f.displayName="CardHeader";let g=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("h3",{ref:e,className:(0,d.cn)("text-2xl font-semibold leading-none tracking-tight",a),...c}));g.displayName="CardTitle";let h=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("p",{ref:e,className:(0,d.cn)("text-sm text-muted-foreground",a),...c}));h.displayName="CardDescription";let i=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("div",{ref:e,className:(0,d.cn)("p-6 pt-0",a),...c}));i.displayName="CardContent";let j=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("div",{ref:e,className:(0,d.cn)("flex items-center p-6 pt-0",a),...c}));j.displayName="CardFooter",a.s(["Card",()=>e,"CardContent",()=>i,"CardDescription",()=>h,"CardFooter",()=>j,"CardHeader",()=>f,"CardTitle",()=>g])},96221,a=>{"use strict";let b=(0,a.i(70106).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);a.s(["Loader2",()=>b],96221)},69520,a=>{"use strict";let b=(0,a.i(70106).default)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);a.s(["RefreshCw",()=>b],69520)},5560,19569,a=>{"use strict";var b=a.i(72131),c=a.i(69769);a.s(["usePaymentRetry",0,({maxRetries:a=3,retryDelay:d=2e3}={})=>{let[e,f]=(0,b.useState)(0),[g,h]=(0,b.useState)(!1);return{executeWithRetry:(0,b.useCallback)(async(b,e=()=>!0)=>{let g;for(let i=0;i<=a;i++)try{i>0&&(h(!0),c.toast.info(`Retrying payment... (${i}/${a})`),await new Promise(a=>setTimeout(a,d)));let e=await b();return f(0),h(!1),e}catch(b){if(g=b,f(i+1),i===a||!e(b))throw h(!1),b}throw h(!1),g},[a,d]),retryCount:e,isRetrying:g,canRetry:e<a,reset:(0,b.useCallback)(()=>{f(0),h(!1)},[])}}],5560);let d={PAYMENT_DECLINED:"Your payment was declined. Please try with a different payment method.",INSUFFICIENT_FUNDS:"Insufficient funds in your account. Please try with a different account or card.",CARD_EXPIRED:"Your card has expired. Please use a different card.",INVALID_CARD:"Invalid card details. Please check and try again.",TRANSACTION_TIMEOUT:"Payment timed out. Please try again.",NETWORK_ERROR:"Network error occurred. Please check your connection and try again.",BANK_SERVER_ERROR:"Bank server is temporarily unavailable. Please try again later.",GATEWAY_ERROR:"Payment gateway error. Please try again.",USER_CANCELLED:"Payment was cancelled by you.",TRANSACTION_CANCELLED:"Transaction was cancelled.",INVALID_MERCHANT:"Merchant configuration error. Please contact support.",INVALID_AMOUNT:"Invalid transaction amount.",DUPLICATE_TRANSACTION:"Duplicate transaction detected.",UNKNOWN_ERROR:"An unexpected error occurred. Please try again or contact support."};a.s(["getErrorMessage",0,a=>d[a]||d.UNKNOWN_ERROR,"isRetryableError",0,a=>["TRANSACTION_TIMEOUT","NETWORK_ERROR","BANK_SERVER_ERROR","GATEWAY_ERROR"].includes(a)],19569)},19195,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(91119),f=a.i(99570),g=a.i(70106);let h=(0,g.default)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);var i=a.i(96221);let j=(0,g.default)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var k=a.i(69520),l=a.i(74167),m=a.i(69769),n=a.i(5560),o=a.i(19569);function p(){let a=(0,d.useSearchParams)(),g=(0,d.useRouter)(),[p,q]=(0,c.useState)(!0),[r,s]=(0,c.useState)("pending"),[t,u]=(0,c.useState)(null),[v,w]=(0,c.useState)(""),{executeWithRetry:x,isRetrying:y}=(0,n.usePaymentRetry)({maxRetries:3,retryDelay:2e3}),z=a.get("transactionId"),A=a.get("orderId"),B=(0,c.useCallback)(async()=>{try{q(!0),w(""),await x(async()=>{let{data:a,error:b}=await l.supabase.functions.invoke("verify-phonepe-payment",{body:{transactionId:z}});if(b)throw b;if(a.success){if(s("success"),m.toast.success("Payment successful!"),A){let{data:a,error:b}=await l.supabase.from("orders").select("id, user_id, total_amount, status, created_at, updated_at, order_number, shipping_address, payment_method, payment_status").eq("id",A).single();!b&&a&&u({...a,shipping_address:a.shipping_address||{}})}}else{s("failed");let b=(0,o.getErrorMessage)(a.errorCode||"UNKNOWN_ERROR");w(a.message||b),m.toast.error(b)}})}catch(b){console.error("Payment verification error:",b),s("failed");let a=b?.details?.errorCode||"VERIFICATION_ERROR";w((0,o.getErrorMessage)(a)),m.toast.error("Failed to verify payment")}finally{q(!1)}},[z,A,x]);return(0,c.useEffect)(()=>{z?B():(s("failed"),w("Invalid payment session. No transaction ID found."),q(!1))},[z,B]),(0,b.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,b.jsx)("div",{className:"max-w-md mx-auto",children:(0,b.jsxs)(e.Card,{children:[(0,b.jsxs)(e.CardHeader,{className:"text-center",children:[(0,b.jsxs)("div",{className:"flex justify-center mb-4",children:[(p||y)&&(0,b.jsx)(i.Loader2,{className:"h-12 w-12 animate-spin text-blue-600"}),!p&&!y&&"success"===r&&(0,b.jsx)(h,{className:"h-12 w-12 text-green-600"}),!p&&!y&&"failed"===r&&(0,b.jsx)(j,{className:"h-12 w-12 text-red-600"})]}),(0,b.jsxs)(e.CardTitle,{children:[(p||y)&&"Verifying Payment...",!p&&!y&&"success"===r&&"Payment Successful!",!p&&!y&&"failed"===r&&"Payment Failed"]})]}),(0,b.jsxs)(e.CardContent,{className:"space-y-4",children:[(p||y)&&(0,b.jsx)("p",{className:"text-center text-gray-600",children:y?"Retrying verification...":"Please wait while we verify your payment..."}),!p&&!y&&"success"===r&&(0,b.jsxs)("div",{className:"text-center space-y-4",children:[(0,b.jsx)("p",{className:"text-green-600",children:"Your order has been placed successfully!"}),t&&(0,b.jsxs)("div",{className:"bg-green-50 p-4 rounded-md",children:[(0,b.jsxs)("p",{className:"text-sm text-green-800",children:["Order Number: ",t.order_number]}),(0,b.jsxs)("p",{className:"text-sm text-green-800",children:["Amount: â‚¹",t.total_amount]})]}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"You will receive an email confirmation shortly."})]}),!p&&!y&&"failed"===r&&(0,b.jsxs)("div",{className:"text-center space-y-4",children:[(0,b.jsx)("p",{className:"text-red-600",children:v||"There was an issue with your payment."}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(f.Button,{onClick:()=>{B()},variant:"outline",className:"w-full",children:[(0,b.jsx)(k.RefreshCw,{className:"h-4 w-4 mr-2"}),"Retry Verification"]}),(0,b.jsxs)("p",{className:"text-sm text-gray-600",children:["If the issue persists, please contact support with transaction ID: ",z]})]})]}),(0,b.jsx)(f.Button,{onClick:()=>{"success"===r?g.push("/dashboard/orders"):g.push("/cart")},className:"w-full",disabled:p||y,children:"success"===r?"View Orders":"Back to Cart"})]})]})})})}function q(){return(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(i.Loader2,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),(0,b.jsx)("p",{children:"Loading..."})]})}),children:(0,b.jsx)(p,{})})}a.s(["default",()=>q],19195)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__7beffb62._.js.map