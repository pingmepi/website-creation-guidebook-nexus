(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,15288,e=>{"use strict";var a=e.i(43476),t=e.i(71645),s=e.i(75157);let r=t.forwardRef(({className:e,...t},r)=>(0,a.jsx)("div",{ref:r,className:(0,s.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));r.displayName="Card";let i=t.forwardRef(({className:e,...t},r)=>(0,a.jsx)("div",{ref:r,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",e),...t}));i.displayName="CardHeader";let c=t.forwardRef(({className:e,...t},r)=>(0,a.jsx)("h3",{ref:r,className:(0,s.cn)("text-2xl font-semibold leading-none tracking-tight",e),...t}));c.displayName="CardTitle";let n=t.forwardRef(({className:e,...t},r)=>(0,a.jsx)("p",{ref:r,className:(0,s.cn)("text-sm text-muted-foreground",e),...t}));n.displayName="CardDescription";let l=t.forwardRef(({className:e,...t},r)=>(0,a.jsx)("div",{ref:r,className:(0,s.cn)("p-6 pt-0",e),...t}));l.displayName="CardContent";let d=t.forwardRef(({className:e,...t},r)=>(0,a.jsx)("div",{ref:r,className:(0,s.cn)("flex items-center p-6 pt-0",e),...t}));d.displayName="CardFooter",e.s(["Card",()=>r,"CardContent",()=>l,"CardDescription",()=>n,"CardFooter",()=>d,"CardHeader",()=>i,"CardTitle",()=>c])},18566,(e,a,t)=>{a.exports=e.r(76562)},31278,e=>{"use strict";let a=(0,e.i(75254).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>a],31278)},16715,e=>{"use strict";let a=(0,e.i(75254).default)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);e.s(["RefreshCw",()=>a],16715)},99749,68509,e=>{"use strict";var a=e.i(71645),t=e.i(73635);e.s(["usePaymentRetry",0,({maxRetries:e=3,retryDelay:s=2e3}={})=>{let[r,i]=(0,a.useState)(0),[c,n]=(0,a.useState)(!1);return{executeWithRetry:(0,a.useCallback)(async(a,r=()=>!0)=>{let c;for(let l=0;l<=e;l++)try{l>0&&(n(!0),t.toast.info(`Retrying payment... (${l}/${e})`),await new Promise(e=>setTimeout(e,s)));let r=await a();return i(0),n(!1),r}catch(a){if(c=a,i(l+1),l===e||!r(a))throw n(!1),a}throw n(!1),c},[e,s]),retryCount:r,isRetrying:c,canRetry:r<e,reset:(0,a.useCallback)(()=>{i(0),n(!1)},[])}}],99749);let s={PAYMENT_DECLINED:"Your payment was declined. Please try with a different payment method.",INSUFFICIENT_FUNDS:"Insufficient funds in your account. Please try with a different account or card.",CARD_EXPIRED:"Your card has expired. Please use a different card.",INVALID_CARD:"Invalid card details. Please check and try again.",TRANSACTION_TIMEOUT:"Payment timed out. Please try again.",NETWORK_ERROR:"Network error occurred. Please check your connection and try again.",BANK_SERVER_ERROR:"Bank server is temporarily unavailable. Please try again later.",GATEWAY_ERROR:"Payment gateway error. Please try again.",USER_CANCELLED:"Payment was cancelled by you.",TRANSACTION_CANCELLED:"Transaction was cancelled.",INVALID_MERCHANT:"Merchant configuration error. Please contact support.",INVALID_AMOUNT:"Invalid transaction amount.",DUPLICATE_TRANSACTION:"Duplicate transaction detected.",UNKNOWN_ERROR:"An unexpected error occurred. Please try again or contact support."};e.s(["getErrorMessage",0,e=>s[e]||s.UNKNOWN_ERROR,"isRetryableError",0,e=>["TRANSACTION_TIMEOUT","NETWORK_ERROR","BANK_SERVER_ERROR","GATEWAY_ERROR"].includes(e)],68509)},56537,e=>{"use strict";var a=e.i(43476),t=e.i(71645),s=e.i(18566),r=e.i(15288),i=e.i(19455),c=e.i(75254);let n=(0,c.default)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);var l=e.i(31278);let d=(0,c.default)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var o=e.i(16715),u=e.i(41867),m=e.i(73635),y=e.i(99749),f=e.i(68509);function p(){let e=(0,s.useSearchParams)(),c=(0,s.useRouter)(),[p,h]=(0,t.useState)(!0),[x,N]=(0,t.useState)("pending"),[R,C]=(0,t.useState)(null),[g,w]=(0,t.useState)(""),{executeWithRetry:j,isRetrying:E}=(0,y.usePaymentRetry)({maxRetries:3,retryDelay:2e3}),v=e.get("transactionId"),_=e.get("orderId"),T=(0,t.useCallback)(async()=>{try{h(!0),w(""),await j(async()=>{let{data:e,error:a}=await u.supabase.functions.invoke("verify-phonepe-payment",{body:{transactionId:v}});if(a)throw a;if(e.success){if(N("success"),m.toast.success("Payment successful!"),_){let{data:e,error:a}=await u.supabase.from("orders").select("id, user_id, total_amount, status, created_at, updated_at, order_number, shipping_address, payment_method, payment_status").eq("id",_).single();!a&&e&&C({...e,shipping_address:e.shipping_address||{}})}}else{N("failed");let a=(0,f.getErrorMessage)(e.errorCode||"UNKNOWN_ERROR");w(e.message||a),m.toast.error(a)}})}catch(a){console.error("Payment verification error:",a),N("failed");let e=a?.details?.errorCode||"VERIFICATION_ERROR";w((0,f.getErrorMessage)(e)),m.toast.error("Failed to verify payment")}finally{h(!1)}},[v,_,j]);return(0,t.useEffect)(()=>{v?T():(N("failed"),w("Invalid payment session. No transaction ID found."),h(!1))},[v,T]),(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsx)("div",{className:"max-w-md mx-auto",children:(0,a.jsxs)(r.Card,{children:[(0,a.jsxs)(r.CardHeader,{className:"text-center",children:[(0,a.jsxs)("div",{className:"flex justify-center mb-4",children:[(p||E)&&(0,a.jsx)(l.Loader2,{className:"h-12 w-12 animate-spin text-blue-600"}),!p&&!E&&"success"===x&&(0,a.jsx)(n,{className:"h-12 w-12 text-green-600"}),!p&&!E&&"failed"===x&&(0,a.jsx)(d,{className:"h-12 w-12 text-red-600"})]}),(0,a.jsxs)(r.CardTitle,{children:[(p||E)&&"Verifying Payment...",!p&&!E&&"success"===x&&"Payment Successful!",!p&&!E&&"failed"===x&&"Payment Failed"]})]}),(0,a.jsxs)(r.CardContent,{className:"space-y-4",children:[(p||E)&&(0,a.jsx)("p",{className:"text-center text-gray-600",children:E?"Retrying verification...":"Please wait while we verify your payment..."}),!p&&!E&&"success"===x&&(0,a.jsxs)("div",{className:"text-center space-y-4",children:[(0,a.jsx)("p",{className:"text-green-600",children:"Your order has been placed successfully!"}),R&&(0,a.jsxs)("div",{className:"bg-green-50 p-4 rounded-md",children:[(0,a.jsxs)("p",{className:"text-sm text-green-800",children:["Order Number: ",R.order_number]}),(0,a.jsxs)("p",{className:"text-sm text-green-800",children:["Amount: â‚¹",R.total_amount]})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"You will receive an email confirmation shortly."})]}),!p&&!E&&"failed"===x&&(0,a.jsxs)("div",{className:"text-center space-y-4",children:[(0,a.jsx)("p",{className:"text-red-600",children:g||"There was an issue with your payment."}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(i.Button,{onClick:()=>{T()},variant:"outline",className:"w-full",children:[(0,a.jsx)(o.RefreshCw,{className:"h-4 w-4 mr-2"}),"Retry Verification"]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["If the issue persists, please contact support with transaction ID: ",v]})]})]}),(0,a.jsx)(i.Button,{onClick:()=>{"success"===x?c.push("/dashboard/orders"):c.push("/cart")},className:"w-full",disabled:p||E,children:"success"===x?"View Orders":"Back to Cart"})]})]})})})}function h(){return(0,a.jsx)(t.Suspense,{fallback:(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(l.Loader2,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),(0,a.jsx)("p",{children:"Loading..."})]})}),children:(0,a.jsx)(p,{})})}e.s(["default",()=>h],56537)}]);