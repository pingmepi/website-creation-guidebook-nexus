(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,15288,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(75157);let s=r.forwardRef(({className:e,...r},s)=>(0,t.jsx)("div",{ref:s,className:(0,a.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...r}));s.displayName="Card";let i=r.forwardRef(({className:e,...r},s)=>(0,t.jsx)("div",{ref:s,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",e),...r}));i.displayName="CardHeader";let n=r.forwardRef(({className:e,...r},s)=>(0,t.jsx)("h3",{ref:s,className:(0,a.cn)("text-2xl font-semibold leading-none tracking-tight",e),...r}));n.displayName="CardTitle";let d=r.forwardRef(({className:e,...r},s)=>(0,t.jsx)("p",{ref:s,className:(0,a.cn)("text-sm text-muted-foreground",e),...r}));d.displayName="CardDescription";let l=r.forwardRef(({className:e,...r},s)=>(0,t.jsx)("div",{ref:s,className:(0,a.cn)("p-6 pt-0",e),...r}));l.displayName="CardContent";let c=r.forwardRef(({className:e,...r},s)=>(0,t.jsx)("div",{ref:s,className:(0,a.cn)("flex items-center p-6 pt-0",e),...r}));c.displayName="CardFooter",e.s(["Card",()=>s,"CardContent",()=>l,"CardDescription",()=>d,"CardFooter",()=>c,"CardHeader",()=>i,"CardTitle",()=>n])},18566,(e,t,r)=>{t.exports=e.r(76562)},99682,e=>{"use strict";var t=e.i(71645);function r(e){let r=t.useRef({value:e,previous:e});return t.useMemo(()=>(r.current.value!==e&&(r.current.previous=r.current.value,r.current.value=e),r.current.previous),[e])}e.s(["usePrevious",()=>r])},16715,e=>{"use strict";let t=(0,e.i(75254).default)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);e.s(["RefreshCw",()=>t],16715)},99749,68509,e=>{"use strict";var t=e.i(71645),r=e.i(73635);e.s(["usePaymentRetry",0,({maxRetries:e=3,retryDelay:a=2e3}={})=>{let[s,i]=(0,t.useState)(0),[n,d]=(0,t.useState)(!1);return{executeWithRetry:(0,t.useCallback)(async(t,s=()=>!0)=>{let n;for(let l=0;l<=e;l++)try{l>0&&(d(!0),r.toast.info(`Retrying payment... (${l}/${e})`),await new Promise(e=>setTimeout(e,a)));let s=await t();return i(0),d(!1),s}catch(t){if(n=t,i(l+1),l===e||!s(t))throw d(!1),t}throw d(!1),n},[e,a]),retryCount:s,isRetrying:n,canRetry:s<e,reset:(0,t.useCallback)(()=>{i(0),d(!1)},[])}}],99749);let a={PAYMENT_DECLINED:"Your payment was declined. Please try with a different payment method.",INSUFFICIENT_FUNDS:"Insufficient funds in your account. Please try with a different account or card.",CARD_EXPIRED:"Your card has expired. Please use a different card.",INVALID_CARD:"Invalid card details. Please check and try again.",TRANSACTION_TIMEOUT:"Payment timed out. Please try again.",NETWORK_ERROR:"Network error occurred. Please check your connection and try again.",BANK_SERVER_ERROR:"Bank server is temporarily unavailable. Please try again later.",GATEWAY_ERROR:"Payment gateway error. Please try again.",USER_CANCELLED:"Payment was cancelled by you.",TRANSACTION_CANCELLED:"Transaction was cancelled.",INVALID_MERCHANT:"Merchant configuration error. Please contact support.",INVALID_AMOUNT:"Invalid transaction amount.",DUPLICATE_TRANSACTION:"Duplicate transaction detected.",UNKNOWN_ERROR:"An unexpected error occurred. Please try again or contact support."};e.s(["getErrorMessage",0,e=>a[e]||a.UNKNOWN_ERROR,"isRetryableError",0,e=>["TRANSACTION_TIMEOUT","NETWORK_ERROR","BANK_SERVER_ERROR","GATEWAY_ERROR"].includes(e)],68509)},29288,63209,61659,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(81140),s=e.i(20783),i=e.i(30030),n=e.i(48425),d=e.i(42727),l=e.i(69340),c=e.i(86318),o=e.i(35804),u=e.i(99682),m=e.i(96626),p="Radio",[h,x]=(0,i.createContextScope)(p),[y,f]=h(p),g=r.forwardRef((e,i)=>{let{__scopeRadio:d,name:l,checked:c=!1,required:o,disabled:u,value:m="on",onCheck:p,form:h,...x}=e,[f,g]=r.useState(null),j=(0,s.useComposedRefs)(i,e=>g(e)),v=r.useRef(!1),C=!f||h||!!f.closest("form");return(0,t.jsxs)(y,{scope:d,checked:c,disabled:u,children:[(0,t.jsx)(n.Primitive.button,{type:"button",role:"radio","aria-checked":c,"data-state":b(c),"data-disabled":u?"":void 0,disabled:u,value:m,...x,ref:j,onClick:(0,a.composeEventHandlers)(e.onClick,e=>{c||p?.(),C&&(v.current=e.isPropagationStopped(),v.current||e.stopPropagation())})}),C&&(0,t.jsx)(N,{control:f,bubbles:!v.current,name:l,value:m,checked:c,required:o,disabled:u,form:h,style:{transform:"translateX(-100%)"}})]})});g.displayName=p;var j="RadioIndicator",v=r.forwardRef((e,r)=>{let{__scopeRadio:a,forceMount:s,...i}=e,d=f(j,a);return(0,t.jsx)(m.Presence,{present:s||d.checked,children:(0,t.jsx)(n.Primitive.span,{"data-state":b(d.checked),"data-disabled":d.disabled?"":void 0,...i,ref:r})})});v.displayName=j;var N=e=>{let{control:a,checked:s,bubbles:i=!0,...n}=e,d=r.useRef(null),l=(0,u.usePrevious)(s),c=(0,o.useSize)(a);return r.useEffect(()=>{let e=d.current,t=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(l!==s&&t){let r=new Event("click",{bubbles:i});t.call(e,s),e.dispatchEvent(r)}},[l,s,i]),(0,t.jsx)("input",{type:"radio","aria-hidden":!0,defaultChecked:s,...n,tabIndex:-1,ref:d,style:{...e.style,...c,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function b(e){return e?"checked":"unchecked"}var C=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],w="RadioGroup",[k,R]=(0,i.createContextScope)(w,[d.createRovingFocusGroupScope,x]),P=(0,d.createRovingFocusGroupScope)(),E=x(),[_,I]=k(w),S=r.forwardRef((e,r)=>{let{__scopeRadioGroup:a,name:s,defaultValue:i,value:o,required:u=!1,disabled:m=!1,orientation:p,dir:h,loop:x=!0,onValueChange:y,...f}=e,g=P(a),j=(0,c.useDirection)(h),[v,N]=(0,l.useControllableState)({prop:o,defaultProp:i,onChange:y});return(0,t.jsx)(_,{scope:a,name:s,required:u,disabled:m,value:v,onValueChange:N,children:(0,t.jsx)(d.Root,{asChild:!0,...g,orientation:p,dir:j,loop:x,children:(0,t.jsx)(n.Primitive.div,{role:"radiogroup","aria-required":u,"aria-orientation":p,"data-disabled":m?"":void 0,dir:j,...f,ref:r})})})});S.displayName=w;var A="RadioGroupItem",T=r.forwardRef((e,i)=>{let{__scopeRadioGroup:n,disabled:l,...c}=e,o=I(A,n),u=o.disabled||l,m=P(n),p=E(n),h=r.useRef(null),x=(0,s.useComposedRefs)(i,h),y=o.value===c.value,f=r.useRef(!1);return r.useEffect(()=>{let e=e=>{C.includes(e.key)&&(f.current=!0)},t=()=>f.current=!1;return document.addEventListener("keydown",e),document.addEventListener("keyup",t),()=>{document.removeEventListener("keydown",e),document.removeEventListener("keyup",t)}},[]),(0,t.jsx)(d.Item,{asChild:!0,...m,focusable:!u,active:y,children:(0,t.jsx)(g,{disabled:u,required:o.required,checked:y,...p,...c,name:o.name,ref:x,onCheck:()=>o.onValueChange(c.value),onKeyDown:(0,a.composeEventHandlers)(e=>{"Enter"===e.key&&e.preventDefault()}),onFocus:(0,a.composeEventHandlers)(c.onFocus,()=>{f.current&&h.current?.click()})})})});T.displayName=A;var M=r.forwardRef((e,r)=>{let{__scopeRadioGroup:a,...s}=e,i=E(a);return(0,t.jsx)(v,{...i,...s,ref:r})});M.displayName="RadioGroupIndicator";var L=e.i(14683),F=e.i(75157);let O=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)(S,{className:(0,F.cn)("grid gap-2",e),...r,ref:a}));O.displayName=S.displayName;let D=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)(T,{ref:a,className:(0,F.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),...r,children:(0,t.jsx)(M,{className:"flex items-center justify-center",children:(0,t.jsx)(L.Circle,{className:"h-2.5 w-2.5 fill-current text-current"})})}));D.displayName=T.displayName,e.s(["RadioGroup",()=>O,"RadioGroupItem",()=>D],29288);var U=e.i(75254);let B=(0,U.default)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);e.s(["AlertCircle",()=>B],63209);let H=(0,U.default)("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);e.s(["CreditCard",()=>H],61659)},37142,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(18566),s=e.i(33277),i=e.i(75144),n=e.i(19455),d=e.i(15288),l=e.i(93479),c=e.i(10204),o=e.i(72436),u=e.i(29288),m=e.i(20783),p=e.i(30030),h=e.i(81140),x=e.i(69340),y=e.i(99682),f=e.i(35804),g=e.i(96626),j=e.i(48425),v="Checkbox",[N,b]=(0,p.createContextScope)(v),[C,w]=N(v),k=r.forwardRef((e,a)=>{let{__scopeCheckbox:s,name:i,checked:n,defaultChecked:d,required:l,disabled:c,value:o="on",onCheckedChange:u,form:p,...y}=e,[f,g]=r.useState(null),v=(0,m.useComposedRefs)(a,e=>g(e)),N=r.useRef(!1),b=!f||p||!!f.closest("form"),[w=!1,k]=(0,x.useControllableState)({prop:n,defaultProp:d,onChange:u}),R=r.useRef(w);return r.useEffect(()=>{let e=f?.form;if(e){let t=()=>k(R.current);return e.addEventListener("reset",t),()=>e.removeEventListener("reset",t)}},[f,k]),(0,t.jsxs)(C,{scope:s,state:w,disabled:c,children:[(0,t.jsx)(j.Primitive.button,{type:"button",role:"checkbox","aria-checked":_(w)?"mixed":w,"aria-required":l,"data-state":I(w),"data-disabled":c?"":void 0,disabled:c,value:o,...y,ref:v,onKeyDown:(0,h.composeEventHandlers)(e.onKeyDown,e=>{"Enter"===e.key&&e.preventDefault()}),onClick:(0,h.composeEventHandlers)(e.onClick,e=>{k(e=>!!_(e)||!e),b&&(N.current=e.isPropagationStopped(),N.current||e.stopPropagation())})}),b&&(0,t.jsx)(E,{control:f,bubbles:!N.current,name:i,value:o,checked:w,required:l,disabled:c,form:p,style:{transform:"translateX(-100%)"},defaultChecked:!_(d)&&d})]})});k.displayName=v;var R="CheckboxIndicator",P=r.forwardRef((e,r)=>{let{__scopeCheckbox:a,forceMount:s,...i}=e,n=w(R,a);return(0,t.jsx)(g.Presence,{present:s||_(n.state)||!0===n.state,children:(0,t.jsx)(j.Primitive.span,{"data-state":I(n.state),"data-disabled":n.disabled?"":void 0,...i,ref:r,style:{pointerEvents:"none",...e.style}})})});P.displayName=R;var E=e=>{let{control:a,checked:s,bubbles:i=!0,defaultChecked:n,...d}=e,l=r.useRef(null),c=(0,y.usePrevious)(s),o=(0,f.useSize)(a);r.useEffect(()=>{let e=l.current,t=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(c!==s&&t){let r=new Event("click",{bubbles:i});e.indeterminate=_(s),t.call(e,!_(s)&&s),e.dispatchEvent(r)}},[c,s,i]);let u=r.useRef(!_(s)&&s);return(0,t.jsx)("input",{type:"checkbox","aria-hidden":!0,defaultChecked:n??u.current,...d,tabIndex:-1,ref:l,style:{...e.style,...o,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function _(e){return"indeterminate"===e}function I(e){return _(e)?"indeterminate":e?"checked":"unchecked"}var S=e.i(43531),A=e.i(75157);let T=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)(k,{ref:a,className:(0,A.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...r,children:(0,t.jsx)(P,{className:(0,A.cn)("flex items-center justify-center text-current"),children:(0,t.jsx)(S.Check,{className:"h-4 w-4"})})}));T.displayName=k.displayName;var M=e.i(41867),L=e.i(73635),F=e.i(12995),O=e.i(75254);let D=(0,O.default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),U=(0,O.default)("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);var B=e.i(63209),H=e.i(16715),q=e.i(61659);let W=(0,O.default)("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]),G=(0,O.default)("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]),K=({selectedMethod:e,onMethodChange:r})=>{let a=[{id:"UPI",name:"UPI",description:"Pay using UPI apps like GPay, PhonePe, Paytm",icon:(0,t.jsx)(U,{className:"h-5 w-5"})},{id:"CARD",name:"Credit/Debit Card",description:"Visa, Mastercard, RuPay cards",icon:(0,t.jsx)(q.CreditCard,{className:"h-5 w-5"})},{id:"NB",name:"Net Banking",description:"Pay directly from your bank account",icon:(0,t.jsx)(W,{className:"h-5 w-5"})},{id:"WALLET",name:"Wallets",description:"PayTM, Mobikwik, Freecharge",icon:(0,t.jsx)(G,{className:"h-5 w-5"})}];return(0,t.jsxs)(d.Card,{children:[(0,t.jsx)(d.CardHeader,{children:(0,t.jsx)(d.CardTitle,{children:"Select Payment Method"})}),(0,t.jsx)(d.CardContent,{children:(0,t.jsx)(u.RadioGroup,{value:e,onValueChange:r,children:a.map(e=>(0,t.jsxs)("div",{className:"flex items-start space-x-3 p-3 rounded-lg border hover:bg-gray-50",children:[(0,t.jsx)(u.RadioGroupItem,{value:e.id,id:e.id,className:"mt-1"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)(c.Label,{htmlFor:e.id,className:"flex items-center gap-2 cursor-pointer",children:[e.icon,(0,t.jsx)("span",{className:"font-medium",children:e.name})]}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.description})]})]},e.id))})})]})},V=(0,O.default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),$=({duration:e,onTimeout:a})=>{let s,[i,n]=(0,r.useState)(e);(0,r.useEffect)(()=>{if(i<=0)return void a();let e=setInterval(()=>{n(e=>e-1)},1e3);return()=>clearInterval(e)},[i,a]);let d=i<=60;return(0,t.jsxs)("div",{className:`flex items-center gap-2 p-3 rounded-md ${d?"bg-red-50 text-red-700":"bg-blue-50 text-blue-700"}`,children:[(0,t.jsx)(V,{className:"h-4 w-4"}),(0,t.jsxs)("span",{className:"text-sm font-medium",children:["Payment expires in: ",(s=Math.floor(i/60),`${s}:${(i%60).toString().padStart(2,"0")}`)]})]})};var z=e.i(99749),Y=e.i(68509);let X=({orderId:e,amount:a,onSuccess:s,onCancel:i})=>{let[l,c]=(0,r.useState)(!1),[o,u]=(0,r.useState)("UPI"),[m,p]=(0,r.useState)(!1),[h,x]=(0,r.useState)(null),{executeWithRetry:y,isRetrying:f,canRetry:g,reset:j}=(0,z.usePaymentRetry)({maxRetries:3,retryDelay:2e3}),v=async()=>{c(!0),x(null),j();try{await y(async()=>{let{data:t,error:r}=await M.supabase.functions.invoke("initiate-phonepe-payment",{body:{orderId:e,amount:Math.round(100*a),currency:"INR",paymentMethod:o,redirectUrl:`${window.location.origin}/payment-success`,callbackUrl:`${window.location.origin}/payment-callback`}});if(r)throw r;if(t?.paymentUrl)window.location.href=t.paymentUrl;else throw Error("Failed to get payment URL")},e=>{let t=e?.details?.code||e?.code||"UNKNOWN_ERROR";return x((0,Y.getErrorMessage)(t)),(0,Y.isRetryableError)(t)})}catch(r){console.error("PhonePe payment error:",r);let e=r?.details?.code||"UNKNOWN_ERROR",t=(0,Y.getErrorMessage)(e);x(t),L.toast.error(t),c(!1)}};return(0,t.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,t.jsxs)("div",{className:"max-w-md mx-auto space-y-6",children:[(0,t.jsxs)(d.Card,{children:[(0,t.jsx)(d.CardHeader,{children:(0,t.jsxs)(d.CardTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(U,{className:"h-5 w-5"}),"PhonePe Payment"]})}),(0,t.jsxs)(d.CardContent,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:["Order ID: ",e]}),(0,t.jsxs)("p",{className:"text-2xl font-bold",children:["₹",a.toFixed(2)]})]}),!l&&!m&&(0,t.jsx)($,{duration:300,onTimeout:()=>{p(!0),c(!1),L.toast.error("Payment session expired. Please try again.")}}),m&&(0,t.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-red-800",children:[(0,t.jsx)(B.AlertCircle,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"text-sm font-medium",children:"Payment Session Expired"})]}),(0,t.jsx)("p",{className:"text-sm text-red-700 mt-1",children:"Your payment session has expired. Please start a new payment."})]}),h&&(0,t.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-red-800",children:[(0,t.jsx)(B.AlertCircle,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"text-sm font-medium",children:"Payment Error"})]}),(0,t.jsx)("p",{className:"text-sm text-red-700 mt-1",children:h})]})]})]}),!m&&(0,t.jsx)(K,{selectedMethod:o,onMethodChange:u}),(0,t.jsx)(d.Card,{children:(0,t.jsxs)(d.CardContent,{className:"p-4",children:[(0,t.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(U,{className:"h-4 w-4 text-blue-600"}),(0,t.jsx)("span",{className:"text-sm font-medium text-blue-800",children:"Secure Payment"})]}),(0,t.jsx)("p",{className:"text-sm text-blue-700",children:"You will be redirected to PhonePe to complete your payment securely. Supports UPI, Cards, Net Banking & Wallets."})]}),(0,t.jsxs)("div",{className:"space-y-2 mt-4",children:[m||h?(0,t.jsx)(n.Button,{onClick:()=>{p(!1),x(null),v()},disabled:l||f,className:"w-full bg-purple-600 hover:bg-purple-700",children:f?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(H.RefreshCw,{className:"h-4 w-4 mr-2 animate-spin"}),"Retrying..."]}):"Retry Payment"}):(0,t.jsx)(n.Button,{onClick:v,disabled:l||f,className:"w-full bg-purple-600 hover:bg-purple-700",children:l||f?"Redirecting to PhonePe...":`Pay ₹${a.toFixed(2)} with PhonePe`}),(0,t.jsxs)(n.Button,{onClick:i,variant:"outline",className:"w-full",disabled:l||f,children:[(0,t.jsx)(D,{className:"h-4 w-4 mr-2"}),"Back to Checkout"]})]})]})})]})})};function Q(){let{user:e,isAuthenticated:m}=(0,s.useUser)(),{cartItems:p,customDesigns:h,clearCart:x}=(0,i.useCart)(),y=(0,a.useRouter)(),[f,g]=(0,r.useState)(!1),[j,v]=(0,r.useState)([]),[N,b]=(0,r.useState)(""),[C,w]=(0,r.useState)(!1),[k,R]=(0,r.useState)(!1),[P,E]=(0,r.useState)(!1),[_,I]=(0,r.useState)(null),[S,A]=(0,r.useState)({name:"",street_address:"",city:"",state:"",postal_code:"",country:"India"}),O=[{id:"1",name:"Classic White Tee",price:"₹2,070",image:F.tshirtImages.mockup1},{id:"2",name:"Urban Black Design",price:"₹2,490",image:F.tshirtImages.mockup2},{id:"3",name:"Summer Collection",price:"₹2,240",image:F.tshirtImages.mockup3},{id:"4",name:"Vintage Edition",price:"₹2,740",image:F.tshirtImages.mockup4},{id:"5",name:"Modern Minimalist",price:"₹2,320",image:F.tshirtImages.mockup5},{id:"6",name:"Artist Series",price:"₹2,900",image:F.tshirtImages.mockup6},{id:"7",name:"Classic Blue Tee",price:"₹2,070",image:F.tshirtImages.mockup1},{id:"8",name:"Urban Gray Design",price:"₹2,490",image:F.tshirtImages.mockup2},{id:"9",name:"Winter Collection",price:"₹2,240",image:F.tshirtImages.mockup3}],D=p.map(e=>{let t=O.find(t=>t.id===e.product_id);return{...e,product:t}});(0,r.useEffect)(()=>{m?0!==p.length||h&&0!==h.length?U():y.push("/cart"):y.push("/")},[m,p.length,h?.length,h,y]);let U=(0,r.useCallback)(async()=>{if(e)try{let{data:t,error:r}=await M.supabase.from("addresses").select("id, name, street_address, city, state, postal_code, country, is_default").eq("user_id",e.id).order("is_default",{ascending:!1});if(r)throw r;let a=t||[];v(a);let s=a.find(e=>e.is_default);s&&b(s.id)}catch(e){console.error("Error fetching addresses:",e)}},[e]),B=()=>(D.reduce((e,t)=>e+parseFloat(t.product?.price?.replace("₹","").replace(",","")||"0")*t.quantity,0)+(h||[]).reduce((e,t)=>e+t.base_price,0)).toFixed(2),H=async()=>{if(!e||!k)return null;try{let t=e=>e.replace(/<[^>]*>/g,"").trim(),r={name:t(S.name),street_address:t(S.street_address),city:t(S.city),state:t(S.state),postal_code:t(S.postal_code),country:t(S.country)},{data:a,error:s}=await M.supabase.from("addresses").insert({user_id:e.id,...r,is_default:0===j.length}).select("id").single();if(s)throw s;return a}catch(e){throw console.error("Error saving address:",e),e}},q=async()=>{if(e){g(!0);try{let t,r,a=null;if(C){if(!S.name||!S.street_address||!S.city||!S.state||!S.postal_code){L.toast.error("Please fill in all shipping address fields"),g(!1);return}if(r=S,k){let e=await H();a=e?.id}}else{let e=j.find(e=>e.id===N);if(!e){L.toast.error("Please select a shipping address"),g(!1);return}r={name:e.name,street_address:e.street_address,city:e.city,state:e.state,postal_code:e.postal_code,country:e.country},a=e.id}let s=parseFloat(B()),{data:i,error:n}=await M.supabase.from("orders").insert({user_id:e.id,total_amount:s,shipping_address:(t=r,Object.fromEntries(Object.entries(t).map(([e,t])=>[e,"string"==typeof t?t.replace(/<[^>]*>/g,"").trim():t]))),shipping_address_id:a,status:"pending",order_number:""}).select("id").single();if(n||!i)throw n||Error("Failed to create order");let d=i.id,l=D.map(e=>({order_id:d,product_id:e.product_id,quantity:e.quantity,unit_price:parseFloat(e.product?.price?.replace("₹","").replace(",","")||"0"),total_price:parseFloat(e.product?.price?.replace("₹","").replace(",","")||"0")*e.quantity})),c=h.map(e=>({order_id:d,product_id:"custom-design",custom_design_id:e.id,quantity:1,unit_price:e.base_price,total_price:e.base_price})),o=[...l,...c];if(o.length>0){let{error:e}=await M.supabase.from("order_items").insert(o);if(e)throw e}I(d),E(!0)}catch(e){console.error("Error placing order:",e),L.toast.error("Failed to place order. Please try again."),g(!1)}}},W=async()=>{await x(),L.toast.success("Payment successful! Order placed."),y.push("/dashboard/orders")};return m&&(0!==p.length||h&&0!==h.length)?P&&_?(0,t.jsx)(X,{orderId:_,amount:parseFloat(B()),onSuccess:W,onCancel:()=>E(!1)}):(0,t.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,t.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-8",children:"Checkout"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(d.Card,{children:[(0,t.jsx)(d.CardHeader,{children:(0,t.jsx)(d.CardTitle,{children:"Shipping Address"})}),(0,t.jsxs)(d.CardContent,{className:"space-y-4",children:[j.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)(c.Label,{className:"text-base font-medium mb-3 block",children:"Saved Addresses"}),(0,t.jsx)(u.RadioGroup,{value:N,onValueChange:e=>{b(e),w(!1)},children:j.map(e=>(0,t.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,t.jsx)(u.RadioGroupItem,{value:e.id,id:e.id,className:"mt-1"}),(0,t.jsxs)("label",{htmlFor:e.id,className:"text-sm cursor-pointer",children:[(0,t.jsx)("div",{className:"font-medium",children:e.name}),(0,t.jsx)("div",{children:e.street_address}),(0,t.jsxs)("div",{children:[e.city,", ",e.state," ",e.postal_code]}),(0,t.jsx)("div",{children:e.country}),e.is_default&&(0,t.jsx)("span",{className:"text-xs text-blue-600 font-medium",children:"Default"})]})]},e.id))}),(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsx)(n.Button,{variant:"outline",onClick:()=>{w(!0),b("")},className:"w-full",children:"Use New Address"})})]}),(C||0===j.length)&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(c.Label,{htmlFor:"name",children:"Full Name"}),(0,t.jsx)(l.Input,{id:"name",value:S.name,onChange:e=>A({...S,name:e.target.value}),placeholder:"Enter your full name"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(c.Label,{htmlFor:"street",children:"Street Address"}),(0,t.jsx)(l.Input,{id:"street",value:S.street_address,onChange:e=>A({...S,street_address:e.target.value}),placeholder:"Enter your street address"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(c.Label,{htmlFor:"city",children:"City"}),(0,t.jsx)(l.Input,{id:"city",value:S.city,onChange:e=>A({...S,city:e.target.value}),placeholder:"City"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(c.Label,{htmlFor:"state",children:"State"}),(0,t.jsx)(l.Input,{id:"state",value:S.state,onChange:e=>A({...S,state:e.target.value}),placeholder:"State"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(c.Label,{htmlFor:"postal_code",children:"Postal Code"}),(0,t.jsx)(l.Input,{id:"postal_code",value:S.postal_code,onChange:e=>A({...S,postal_code:e.target.value}),placeholder:"Postal Code"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(T,{id:"save-address",checked:k,onCheckedChange:e=>R(e)}),(0,t.jsx)(c.Label,{htmlFor:"save-address",className:"text-sm",children:"Save this address for future orders"})]})]})]})]}),(0,t.jsxs)(d.Card,{children:[(0,t.jsx)(d.CardHeader,{children:(0,t.jsx)(d.CardTitle,{children:"Payment Method"})}),(0,t.jsx)(d.CardContent,{children:(0,t.jsx)("div",{className:"text-sm text-gray-600",children:"UPI, Cards, Net Banking, and Wallet payments available. Payment will be processed securely through PhonePe."})})]})]}),(0,t.jsx)("div",{children:(0,t.jsxs)(d.Card,{className:"sticky top-4",children:[(0,t.jsx)(d.CardHeader,{children:(0,t.jsx)(d.CardTitle,{children:"Order Summary"})}),(0,t.jsxs)(d.CardContent,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-3",children:[D.map(e=>(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"h-16 w-16 flex-shrink-0 overflow-hidden rounded-md border",children:(0,t.jsx)("img",{src:"string"==typeof e.product?.image?e.product.image:e.product?.image?.src,alt:e.product?.name||"Product",className:"h-full w-full object-cover object-center"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:"text-sm font-medium",children:e.product?.name}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:["Qty: ",e.quantity]})]}),(0,t.jsxs)("div",{className:"text-sm font-medium",children:["₹",(parseFloat(e.product?.price?.replace("₹","").replace(",","")||"0")*e.quantity).toLocaleString("en-IN")]})]},e.id)),(h||[]).map(e=>(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"h-16 w-16 flex-shrink-0 overflow-hidden rounded-md border",children:(0,t.jsx)("img",{src:e.design_image,alt:e.design_name,className:"h-full w-full object-cover object-center"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:"text-sm font-medium",children:e.design_name}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Custom Design"})]}),(0,t.jsxs)("div",{className:"text-sm font-medium",children:["₹",e.base_price.toLocaleString("en-IN")]})]},e.id))]}),(0,t.jsx)(o.Separator,{}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{children:"Subtotal"}),(0,t.jsxs)("span",{children:["₹",parseFloat(B()).toLocaleString("en-IN")]})]}),(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{children:"Shipping"}),(0,t.jsx)("span",{children:"Free"})]}),(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{children:"Tax"}),(0,t.jsx)("span",{children:"Calculated at shipping"})]}),(0,t.jsx)(o.Separator,{}),(0,t.jsxs)("div",{className:"flex justify-between font-medium",children:[(0,t.jsx)("span",{children:"Total"}),(0,t.jsxs)("span",{children:["₹",parseFloat(B()).toLocaleString("en-IN")]})]})]}),(0,t.jsx)(n.Button,{className:"w-full",size:"lg",onClick:q,disabled:f,children:f?"Placing Order...":"Proceed to Payment"})]})]})})]})]})}):null}e.s(["default",()=>Q],37142)}]);